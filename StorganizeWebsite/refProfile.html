<!DOCTYPE html>
<html>
<title>Storganize Advocate</title>
<head>
	<!-- Bringing in Firebase -->
		
			<script src="https://www.gstatic.com/firebasejs/3.6.10/firebase.js"></script>
			<script>
			  // Initialize Firebase
			  var config = {
			    apiKey: "AIzaSyCWbr-clEQJaLg_CoUcOR7hMRrPrx46qI0",
			    authDomain: "storganize-referral.firebaseapp.com",
			    databaseURL: "https://storganize-referral.firebaseio.com",
			    storageBucket: "storganize-referral.appspot.com",
			    messagingSenderId: "314957063559"
			  };
			  firebase.initializeApp(config);
			</script>

		<!-- Bringing in jQuery -->
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.js"></script>

		<!-- Bringing in Materialize via CDN -->
				<!-- Compiled and minified CSS -->
		  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
		  	<!-- Compiled and minified CSS -->
		  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

		  	<!-- Compiled and minified JavaScript -->
		  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>

		<!-- Bringing in copy to clipboard functionality-->
		  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>

</head>

<body class="#fafafa grey lighten-5">
	
	<!-- All HTML for signup and profile is below -->
	

	<!-- Register / Login Page Header -->
	<div class="container" id="registerLoginForm" style="display:block">
		<h1 class="header center orange-text">Storganize Advocate Portal</h1>
				  

		<!-- Register Form-->

		<div class="card-panel">
	      <ul class="tabs" style="width:75%">
	        <li class="tab col s3 hoverable"><a class="active" href="#registerForm">Register</a></li>
	        <li class="tab col s3 hoverable"><a href="#loginForm">Login</a></li>
	      </ul>	
		    <form class="container" id="registerForm">
		    	<div class="row">
		        	<div class="input-field">
		        		<input id="firstName" type="text" class="validate">
			          <label>First Name</label>
		        	</div>
	      	  </div>
	      	<div class="row">
		        	<div class="input-field">
		        		<input id="lastName" type="text" class="validate">
			          <label>Last Name</label>
		        	</div>
	      	  </div>
	      	<div class="row">
		        	<div class="input-field">
		        		<input id="orgName" type="text" class="validate">
			          <label>Organization Name (if applicable)</label>
		        	</div>
	      	  </div>
		    	<div class="row">
		        	<div class="input-field">
		        		<input id="regEmail" type="email" class="validate">
			          <label for="email" data-error="wrong" data-success="right">Email</label>
		        	</div>
	      	  </div>
	      	 	<div class="row">
		        	<div class="input-field">
			          <input id="regPassword" type="password" class="validate">
			          <label for="password">Create Password</label>
		        	</div>
	      	  	</div>
		        <div class="row">
				      <button class="btn waves-effect waves-light btn-large" id="register">
				          Register
				      </button>
		      	</div>
		    </form>


	

<!-- INSERT LOADING PAGE HERE TO ALLOW REFERRAL CANDY TO PROCESS -->

	<!-- Login Form -->

	<form class="container" id="loginForm">
		<div class="row">
    	<div class="input-field">
    		<input id="loginEmail" type="email" class="validate">
        <label for="email" data-error="wrong" data-success="right">Email</label>
    	</div>
	  </div>
	 	<div class="row">
    	<div class="input-field">
        <input id="loginPassword" type="password" class="validate">
        <label for="password">Input Password</label>
        <a class="modal-trigger" href="#forgotPasswordModal">Forgot password?</a>
    	</div>
	  	</div>
	  <div class="row">
	  	<button class="btn waves-effect waves-light btn-large" id="login">
			          Login
			</button>
	  </div>
	 </form>
</div>

</div>

	<!--Forgot Password Modal-->
	<div id="forgotPasswordModal" class="modal">
    <div class="modal-content" id="forgotPasswordForm">
      <h4>Forgot Your Password?</h4>
	      <input id="forgotPasswordEmail" type="email" class="validate">
	      <label for="email" data-error="wrong" data-success="right">Please enter the email address associated with your account</label>
    </div>
    <div class="container" id="forgotPasswordResult" style="display:none">
	  </div>
    <div class="modal-footer">
      <button class="waves-effect waves-green btn-flat" id="submitPasswordReset">Submit</button>
      <button class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</button>
    </div>
  </div>

	<!-- Profile HTML is below-->
		
	<div id="profile" style="display:none">
		<!-- Welcome Text -->
		<h1 class="center-align" id="yourName">Brendan's Profile</h1>
		<!-- Referral Link Card -->
		<div class="row">
			<div class="col l6 s12">
	    	<div class="card-panel" style="background-color:#f44336">
		        <div class="row">
		        	<div class="card-content white-text">
		              <span class="flow-text white-text">Your Referral Link</span>
		          </div>
		        </div>
		        <div class="row">
		          <div class="card-panel white" style="padding:0px">
		          <p class="center-align black-text" id="referralLink" value="http://storganize.refr.cc/brendand">http://storganize.refr.cc/brendand</p>
		          </div>
		        </div>
		        <div class="card-action">
		        	<a class="waves-effect waves-light btn" data-clipboard-target="#referralLink">
    						Copy to clipboard</a>
		    		</div>
	  		</div>
	  	</div>
	  <!-- Referral Code Card -->
	  
			<div class="col l6 s12">
	    	<div class="card-panel" style="background-color:#2196F3">
		        <div class="row">
		        	<div class="card-content white-text">
		              <span class="flow-text white-text">Your Referral Code</span>
		          </div>
		        </div>
		        <div class="row">
		          <div class="card-panel white" style="padding:0px">
		          <p class="center-align black-text" id="referralCode">testCODE</p>
		          </div>
		        </div>
		         <div class="card-action">
		          <a class="waves-effect waves-light btn" data-clipboard-target="#referralCode">
    						Copy to clipboard</a>
		    		</div>
	  		</div>
	  	</div>
	  
	  <!-- Referral Earnings Card -->
			<div class="col l12 s12">
	    	<div class="card-panel" style="background-color:#009688">
		        <div class="row">
		        	<div class="center-align card-content white-text">
		              <span class="flow-text white-text">Your Earnings</span>
		          </div>
		        </div>
		        <div class="row">
		          <p class="left-align flow-text white-text">Total Referrals: 2</p>
		          <p class="left-align flow-text white-text">Total Cash Earned: $20</p>
		        </div>
		    </div>
	  	</div>
		  	<div class="center-align">
		  	<a class="waves-effect waves-light btn-large orange" id="logout">Log Out</a>
		  	</div>
	  </div>
	 
	</div>
	     


		

		<!-- All Javascript logic is contained within the below script tag for easy embed on Squarespace. When we transition to Storganize App, this code should be placed within a standard index.js file-->

		<script type="text/Javascript">	

		new Clipboard('.btn');

		// Event Listeners
		document.getElementById("register").addEventListener("click", handleRegister);
		document.getElementById("login").addEventListener("click", handleLogin);
		document.getElementById("logout").addEventListener("click", handleSignout);
		document.getElementById("submitPasswordReset").addEventListener("click", resetPassword);

		// View Controllers
		function displayProfile() {
				document.getElementById("registerLoginForm").style.display = 'none';
				document.getElementById("profile").style.display = 'block';
		};

		function displaySignup() {
				document.getElementById("registerLoginForm").style.display = 'block';
				document.getElementById("profile").style.display = 'none';
		};
		
		// Regsitration and Login Logic
		function handleRegister() {
			var email = document.getElementById("regEmail").value;
			var password = document.getElementById("regPassword").value;
			var firstName = document.getElementById("firstName").value;
			var lastName = document.getElementById("lastName").value;
			var orgName = document.getElementById("orgName").value;

			firebase.auth().createUserWithEmailAndPassword(email, password).then(function() {
					var user = firebase.auth().currentUser
	            var uid = user.uid

	            firebase.database().ref('referrers/' + user.uid).set({
	                  email: email,
	                  firstName: firstName,
	                  lastName: lastName,
	                  orgName: orgName,
	                  refCandyCode: ''
		        })
		      document.getElementById("yourName").innerHTML = 'Welcome, ' + '' + firstName;
			  	displayProfile();
				}, function(error){
					alert(error.message);
				})
			};

		function handleLogin() {
			var email = document.getElementById("loginEmail").value
			var password = document.getElementById("loginPassword").value

			// Log in the user and append his/her email to the top of the profile page

		      firebase.auth().signInWithEmailAndPassword(email, password).then(function(){
		        var user = firebase.auth().currentUser;
		        var userEmail;

		        if (user != null) {
		          userEmail = user.email; 
		        }
        document.getElementById("yourName").innerHTML = 'Welcome, ' + '' + email; 		
				displayProfile();
			}, function(error){
					alert(error.message);
				})
		};

		function handleSignout() {
		  firebase.auth().signOut()
		  displaySignup()
		};

		// Forgot Password Logic

			// When the user clicks anywhere outside of the modal, close it
			var modal = document.getElementById('forgotPassword');
			window.onclick = function(event) {
			    if (event.target == modal) {
			        modal.style.display = "none";
			    }
}

		function resetPassword () {
		  var auth = firebase.auth();
		  const emailAddress = document.getElementById('forgotPasswordEmail').value;
		  auth.sendPasswordResetEmail(emailAddress).then(function() {
		    // Display the result of the reset password submission
		    document.getElementById('forgotPasswordForm').style.display = "none";
		    document.getElementById('submitPasswordReset').style.display = "none";
		    document.getElementById('forgotPasswordResult').style.display = "block";
		    document.getElementById('forgotPasswordResult').innerHTML = "Thank you. Please check your email for a link to reset your password.";

		  }, function(error) {
		      // Display Error Message
		    document.getElementById('forgotPasswordResult').innerHTML = 
		        "<div class=\"alert alert-danger\" role=\"alert\" align=\"center\"> \
		        <strong>" + error.message + "</strong>\
		      </div>";
		  });
	}

	$(document).ready(function(){
    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
    $('.modal').modal();
  })



		
		</script>


</body>

</html>