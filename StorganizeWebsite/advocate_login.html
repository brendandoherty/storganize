<head>
  <!-- Bringing in Firebase -->
    
      <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase.js"></script>
      <script>
        // Initialize Firebase
        var config = {
          apiKey: "AIzaSyCWbr-clEQJaLg_CoUcOR7hMRrPrx46qI0",
          authDomain: "storganize-referral.firebaseapp.com",
          databaseURL: "https://storganize-referral.firebaseio.com",
          storageBucket: "storganize-referral.appspot.com",
          messagingSenderId: "314957063559"
        };
        firebase.initializeApp(config);
      </script>

    <!-- Bringing in jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.js"></script>

    <!-- Bringing in Materialize via CDN -->
        <!-- Compiled and minified CSS -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
        <!-- Compiled and minified CSS -->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <!-- Compiled and minified JavaScript -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>

    <!-- Bringing in copy to clipboard functionality-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>


</head>


<!-- Login Form -->

<h1 class="header center orange-text">Storganize Advocate Portal</h1>
	<form class="container" id="loginForm">
		<div class="row">
    	<div class="input-field">
    		<input id="loginEmail" type="email" class="validate">
        <label for="email">Email</label>
    	</div>
	  </div>
	 	<div class="row">
    	<div class="input-field">
        <input id="loginPassword" type="password" class="validate">
        <label for="password">Input Password</label>
        <a class="modal-trigger" id="openPasswordModal">Forgot password?</a>
    	</div>
	  	</div>
	  	<div id="errorMessageLogin"></div>
	  <div class="row">
	  	<a class="waves-effect waves-light btn-large" id="login">
			          Login
			</a>
	  </div>
	 </form>

	<!--Forgot Password Modal-->
	<div id="forgotPasswordModal" class="modal">
    <div class="modal-content" id="forgotPasswordForm">
      <h4>Forgot Your Password?</h4>
	      <input id="forgotPasswordEmail" type="email" class="validate">
	      <label for="email" data-error="wrong" data-success="right">Please enter the email address associated with your account</label>
    </div>
    <div class="container" id="forgotPasswordResult" style="display:none">
	  </div>
    <div class="modal-footer">
      <button class="waves-effect waves-green btn-flat" id="submitPasswordReset">Submit</button>
      <button class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</button>
    </div>
  </div>

<script type="text/javascript">
  document.getElementById("login").addEventListener("click", handleLogin);
   document.getElementById("openPasswordModal").addEventListener("click", displayModal);
  document.getElementById("submitPasswordReset").addEventListener("click", resetPassword);

  function displayProfile() { 
        window.location="https://www.storganize.io/test-advocate-profile";
        window.scrollTo(0,0)
    };

  function displayModal() {
      $("#forgotPasswordModal").modal('open');
    }

  // Forgot Password Logic
      // When the user clicks anywhere outside of the modal, close it
      var modal = document.getElementById('forgotPassword');
      window.onclick = function(event) {
          if (event.target == modal) {
              modal.style.display = "none";
          }
}

    function handleLogin() {
      var email = document.getElementById("loginEmail").value
      var password = document.getElementById("loginPassword").value
          firebase.auth().signInWithEmailAndPassword(email, password).then(function(){
            var user = firebase.auth().currentUser;
            var userEmail;
            if (user != null) {
              userEmail = user.email; 
            } 
        displayProfile();
      }, function(error){
          alert(error.message);
        })
    };

    function resetPassword () {
      var auth = firebase.auth();
      const emailAddress = document.getElementById('forgotPasswordEmail').value;
      auth.sendPasswordResetEmail(emailAddress).then(function() {
        // Display the result of the reset password submission
        document.getElementById('forgotPasswordForm').style.display = "none";
        document.getElementById('submitPasswordReset').style.display = "none";
        document.getElementById('forgotPasswordResult').style.display = "block";
        document.getElementById('forgotPasswordResult').innerHTML = "Thank you. Please check your email for a link to reset your password.";
      }, function(error) {
          // Display Error Message
        document.getElementById('forgotPasswordResult').innerHTML = 
            "<div class=\"alert alert-danger\" role=\"alert\" align=\"center\"> \
            <strong>" + error.message + "</strong>\
          </div>";
      });
  }

  $(document).ready(function(){
    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
    $('.modal').modal();
  })

</script>