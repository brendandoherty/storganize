<!DOCTYPE html>
<html>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>
	<body class="w3-light-grey"">

<!-- All HTML for signup and profile is below -->

<!-- Signup Form HTML is below-->
		<div class="w3-card-4" id="signupForm" style="display:block">

			<div class="w3-container w3-green">
			  <h2>Referrer Sign Up</h2>
			</div>

			<form class="w3-container">

				<label class="w3-label w3-validate"">Email</label>
				<input class="w3-input" id='email' type="text" required>
				
				<label class="w3-label w3-validate">Password</label>
				<input class="w3-input" id='password' type="password" required>

				<button class="w3-button w3-large w3-hover-teal" id="register">Register</button>

				<button class="w3-button w3-large w3-hover-teal" id="login">Login</button>

			</form>
		</div>

<!-- Profile HTML is below-->
		<div id="profile" style="display:none">

	      <!-- !PAGE CONTENT! -->
	      <div class="w3-main">

	        <!-- Header -->
	        <header class="w3-container" style="padding-top:10px padding-bottom:10px">
	          <p><h1 id= "yourName">John Doe</h1></p>
	        </header>

	        <div class="w3-row-padding w3-margin-bottom">
	          
	          <div class="w3-container">
	            <div class="w3-container w3-blue w3-padding-16">
	              <div class="w3-left"><i class="fa fa-eye w3-xxxlarge"></i></div>
	              <div class="w3-right">
	                <p><h3 id= "yourCode">stor2099</h3></p>
	              </div>
	              <div class="w3-clear"></div>
	              <h4>Your Referral Code</h4>
	            </div>
	         </div>

	         <div class="w3-row-padding w3-margin-bottom">

	          </div>
	          <div class="w3-half">
	            <div class="w3-container w3-teal w3-padding-16">
	              <div class="w3-left"><i class="fa fa-share-alt w3-xxxlarge"></i></div>
	              <div class="w3-right">
	                <h3>2</h3>
	              </div>
	              <div class="w3-clear"></div>
	              <h4>Your Referrals</h4>
	            </div>
	          </div>
	          <div class="w3-half">
	            <div class="w3-container w3-teal w3-padding-16">
	              <div class="w3-left"><i class="fa fa-share-alt w3-xxxlarge"></i></div>
	              <div class="w3-right">
	                <h3>$20</h3>
	              </div>
	              <div class="w3-clear"></div>
	              <h4>Total Earnings</h4>
	            </div>
	          </div>

	        </div>

	        <!-- End page content -->
	      </div>
		</div>


		<!-- Bringing in Firebase -->
		<script src="https://www.gstatic.com/firebasejs/3.6.10/firebase.js"></script>
		<script>
		  // Initialize Firebase
		  var config = {
		    apiKey: "AIzaSyCWbr-clEQJaLg_CoUcOR7hMRrPrx46qI0",
		    authDomain: "storganize-referral.firebaseapp.com",
		    databaseURL: "https://storganize-referral.firebaseio.com",
		    storageBucket: "storganize-referral.appspot.com",
		    messagingSenderId: "314957063559"
		  };
		  firebase.initializeApp(config);
		</script>

		<!-- All Javascript logic is contained within the below script tag for easy embed on Squarespace. When we transition to Storganize App, this code should be placed within a standard index.js file-->

		<script type="text/Javascript">	
		// Model
		var referrers = {
			loggedIn: false,
			name: undefined
		}

		document.getElementById("register").addEventListener("click", handleRegister);
		document.getElementById("login").addEventListener("click", handleLogin);
		

		function handleRegister() {
			var email = document.getElementById("email").value
			var password = document.getElementById("password").value

			firebase.auth().createUserWithEmailAndPassword(email, password).then(function pushData() {
				  	var user = firebase.auth().currentUser
				  	var uid = user.uid
					var refCode = 'stor' + Math.floor((Math.random() * 9999) + 1000)

					  firebase.database().ref('referrers/' + user.uid).set({
					    		email: email,
					    		discount_code: refCode,
					    		successful_referrals: 0
				})
			}) 
			
			displayProfile()
		};


		function handleLogin() {
			var email = document.getElementById("email").value
			var password = document.getElementById("password").value		
			
			// Log in the user and append his/her email to the top of the profile page

			firebase.auth().signInWithEmailAndPassword(email, password).then(function(){
				var user = firebase.auth().currentUser;
			 	var userEmail, uid, discount_code;

				if (user != null) {
				  userEmail = user.email; 
				}
				document.getElementById("yourName").innerHTML = 'Welcome, ' + '' + userEmail;
				displayProfile()
			});
		}

		function displayProfile() {

				document.getElementById("signupForm").style.display = 'none';
				document.getElementById("profile").style.display = 'block';
		}
		
		</script>

	</body>

</html>