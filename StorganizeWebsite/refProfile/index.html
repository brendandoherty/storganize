<!DOCTYPE html>
<html>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>
	<body class="w3-light-grey">

<!-- All HTML for signup and profile is below -->

<!-- Signup Form HTML is below-->
		<div class="w3-card-4" id="signupForm" style="display:block">

			<div class="w3-container w3-green">
			  <h2>Referrer Sign Up</h2>
			</div>

			<div class="w3-container">

				<label class="w3-label w3-validate"">Email</label>
				<input class="w3-input" id='email' type="text" required>
				
				<label class="w3-label w3-validate">Password</label>
				<input class="w3-input" id='password' type="password" required>

				<button class="w3-button w3-large w3-hover-teal" id="register">Register</button>

				<button class="w3-button w3-large w3-hover-teal" id="login">Login</button>

			</div>
		</div>

<!-- Profile HTML is below-->
	      <!-- !PAGE CONTENT! -->
	      <div class="w3-main w3-mobile" id="profile" style="display:none">
	        <!-- Header -->
	        <header class="w3-container" style="padding-top:10px padding-bottom:10px">
	          <p><h1 id= "yourName">JOHN DOE</h1></p>
	        </header>

	        <!--DEMO CODE-->
	        <div class="w3-row-padding w3-margin-bottom">
					    <div class="w3-third">
					      <div class="w3-container w3-red w3-padding-16">
					        <div class="w3-left"><i class="fa fa-comment w3-xxxlarge"></i></div>
					        <div class="w3-right">
					          <h3>TESTCODE</h3>
					        </div>
					        <div class="w3-clear"></div>
					        <h4>Your Referral Code</h4>
					      </div>
					    </div>
					    <div class="w3-third">
					      <div class="w3-container w3-blue w3-padding-16">
					        <div class="w3-left"><i class="fa fa-eye w3-xxxlarge"></i></div>
					        <div class="w3-right">
					          <h3>2</h3>
					        </div>
					        <div class="w3-clear"></div>
					        <h4>Your Referrals</h4>
					      </div>
					    </div>
					    <div class="w3-third">
					      <div class="w3-container w3-teal w3-padding-16">
					        <div class="w3-left"><i class="fa fa-usd w3-xxxlarge"></i></div>
					        <div class="w3-right">
					          <h3>$20</h3>
					        </div>
					        <div class="w3-clear"></div>
					        <h4>Total Earnings</h4>
					      </div>
					    </div>
					 </div>

					<div class="w3-container w3-mobile">						 
						 <span class="w3-left" style="padding-bottom:10px">
		          	<button class="w3-button w3-large w3-orange w3-text-white" id="logout">Log Out</button>
		          </span>
		      </div>
			<!-- END MAIN CONTENT -->
			</div>
		



		<!-- Bringing in Firebase -->
		
			<script src="https://www.gstatic.com/firebasejs/3.6.10/firebase.js"></script>
			<script>
			  // Initialize Firebase
			  var config = {
			    apiKey: "AIzaSyCWbr-clEQJaLg_CoUcOR7hMRrPrx46qI0",
			    authDomain: "storganize-referral.firebaseapp.com",
			    databaseURL: "https://storganize-referral.firebaseio.com",
			    storageBucket: "storganize-referral.appspot.com",
			    messagingSenderId: "314957063559"
			  };
			  firebase.initializeApp(config);
			</script>

		<!-- All Javascript logic is contained within the below script tag for easy embed on Squarespace. When we transition to Storganize App, this code should be placed within a standard index.js file-->

		<script type="text/Javascript">	

		document.getElementById("register").addEventListener("click", handleRegister);
		document.getElementById("login").addEventListener("click", handleLogin);
		document.getElementById("logout").addEventListener("click", handleSignout);
		

		function handleRegister() {
			var email = document.getElementById("email").value
			var password = document.getElementById("password").value

			firebase.auth().createUserWithEmailAndPassword(email, password).then(function pushData() {
            var user = firebase.auth().currentUser
            var uid = user.uid

            firebase.database().ref('referrers/' + user.uid).set({
                  email: email,
                  refCandyCode: ''
        })
      document.getElementById("yourName").innerHTML = 'Welcome, ' + '' + email;
	  	displayProfile();
		})
	};

		function handleLogin() {
			var email = document.getElementById("email").value
			var password = document.getElementById("password").value

			// Log in the user and append his/her email to the top of the profile page

		      firebase.auth().signInWithEmailAndPassword(email, password).then(function(){
		        var user = firebase.auth().currentUser;
		        var userEmail;

		        if (user != null) {
		          userEmail = user.email; 
		        }
        document.getElementById("yourName").innerHTML = 'Welcome, ' + '' + userEmail; 		
				displayProfile();
			})
		};

		function handleSignout() {
		  firebase.auth().signOut()
		  displaySignup()
		};

		function displayProfile() {
				document.getElementById("signupForm").style.display = 'none';
				document.getElementById("profile").style.display = 'block';
		};

		function displaySignup() {
				document.getElementById("signupForm").style.display = 'block';
				document.getElementById("profile").style.display = 'none';
		};
		
		</script>

	</body>

</html>