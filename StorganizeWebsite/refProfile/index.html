<!DOCTYPE html>
<html>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>
	<body class="w3-light-grey">

<!-- All HTML for signup and profile is below -->

<!-- Signup Form HTML is below-->
		<div class="w3-card-4" id="signupForm" style="display:block">

			<div class="w3-container w3-teal">
			  <h2>Storganize Referrer Portal</h2>
			</div>

			<div class="w3-container w3-padding-16">

				<label class="w3-label">Email</label>
				<input class="w3-input" id='email' type="text" placeholder="Enter Email" required>
				
				<label class="w3-label">Password</label>
				<input class="w3-input" id='password' type="password" placeholder="Enter Password" required>

				<span class="w3-left w3-padding"><a href="#" onclick="document.getElementById('forgotPassword').style.display='block'"">Forgot password?</a></span>

        <div class="w3-container w3-padding-16">
				<button class="w3-button w3-large w3-teal " id="register">Register</button>

				<button class="w3-button w3-large w3-teal" id="login">Login</button>
				</div>

			</div>
		</div>

<!--Forgot Password Modal-->
		<div id="forgotPassword" class="w3-modal" style="display:none">
	    <div class="w3-modal-content w3-card-8">
	      <header class="w3-container w3-teal"> 
	        <span onclick="document.getElementById('forgotPassword').style.display='none'" 
	        class="w3-closebtn">&times;</span>
	        <h2>Forgot Your Password?</h2>
	      </header>
	      <div class="w3-container" id="forgotPasswordForm">
	        <label class="w3-label">Please enter the email address associated with your account</label>
					<input class="w3-input" id='forgotPasswordEmail' type="text" placeholder="Enter Email" required>
	      </div>
	      <div class="w3-container" id="forgotPasswordResult" style="display:none">
	      	<h3>RESULT OF PASSWORD RESET</h3>
	      </div>
	      <div class="w3-container w3-padding">
	        <button class="w3-button w3-large w3-teal" id="submitPasswordReset">Submit</button>
	      </div>
	    </div>
  	</div>

<!-- Profile HTML is below-->
	      <!-- !PAGE CONTENT! -->
	      <div class="w3-main w3-mobile" id="profile" style="display:none">
	        <!-- Header -->
	        <header class="w3-container" style="padding-top:10px padding-bottom:10px">
	          <p><h1 id= "yourName">JOHN DOE</h1></p>
	        </header>

	        <!--DEMO CODE-->
	        <div class="w3-row-padding w3-margin-bottom">
					    <div class="w3-third">
					      <div class="w3-container w3-red w3-padding-16">
					        <div class="w3-left"><i class="fa fa-comment w3-xxxlarge"></i></div>
					        <div class="w3-right">
					          <h4>TESTCODE</h4>
					        </div>
					        <div class="w3-clear"></div>
					        <h4>Your Referral Code</h4>
					      </div>
					    </div>
					    <div class="w3-third">
					      <div class="w3-container w3-blue w3-padding-16">
					        <div class="w3-left"><i class="fa fa-eye w3-xxxlarge"></i></div>
					        <div class="w3-right">
					          <h4>2</h4>
					        </div>
					        <div class="w3-clear"></div>
					        <h4>Your Referrals</h4>
					      </div>
					    </div>
					    <div class="w3-third">
					      <div class="w3-container w3-teal w3-padding-16">
					        <div class="w3-left"><i class="fa fa-usd w3-xxxlarge"></i></div>
					        <div class="w3-right">
					          <h4>$20</h4>
					        </div>
					        <div class="w3-clear"></div>
					        <h4>Total Earnings</h4>
					      </div>
					    </div>
					 </div>

					<div class="w3-container w3-mobile">						 
						 <span class="w3-left" style="padding-bottom:10px">
		          	<button class="w3-button w3-large w3-orange w3-text-white" id="logout">Log Out</button>
		          </span>
		      </div>
			<!-- END MAIN CONTENT -->
			</div>
		



		<!-- Bringing in Firebase -->
		
			<script src="https://www.gstatic.com/firebasejs/3.6.10/firebase.js"></script>
			<script>
			  // Initialize Firebase
			  var config = {
			    apiKey: "AIzaSyCWbr-clEQJaLg_CoUcOR7hMRrPrx46qI0",
			    authDomain: "storganize-referral.firebaseapp.com",
			    databaseURL: "https://storganize-referral.firebaseio.com",
			    storageBucket: "storganize-referral.appspot.com",
			    messagingSenderId: "314957063559"
			  };
			  firebase.initializeApp(config);
			</script>

		<!-- All Javascript logic is contained within the below script tag for easy embed on Squarespace. When we transition to Storganize App, this code should be placed within a standard index.js file-->

		<script type="text/Javascript">	

		// Event Listeners
		document.getElementById("register").addEventListener("click", handleRegister);
		document.getElementById("login").addEventListener("click", handleLogin);
		document.getElementById("logout").addEventListener("click", handleSignout);
		document.getElementById("submitPasswordReset").addEventListener("click", resetPassword);

		// View Controllers
		function displayProfile() {
				document.getElementById("signupForm").style.display = 'none';
				document.getElementById("profile").style.display = 'block';
		};

		function displaySignup() {
				document.getElementById("signupForm").style.display = 'block';
				document.getElementById("profile").style.display = 'none';
		};
		
		// Regsitration and Login Logic
		function handleRegister() {
			var email = document.getElementById("email").value
			var password = document.getElementById("password").value

			firebase.auth().createUserWithEmailAndPassword(email, password).then(function() {
					var user = firebase.auth().currentUser
	            var uid = user.uid

	            firebase.database().ref('referrers/' + user.uid).set({
	                  email: email,
	                  refCandyCode: ''
		        })
		      document.getElementById("yourName").innerHTML = 'Welcome, ' + '' + email;
			  	displayProfile();
				}, function(error){
					alert(error.message);
				})
			};

		function handleLogin() {
			var email = document.getElementById("email").value
			var password = document.getElementById("password").value

			// Log in the user and append his/her email to the top of the profile page

		      firebase.auth().signInWithEmailAndPassword(email, password).then(function(){
		        var user = firebase.auth().currentUser;
		        var userEmail;

		        if (user != null) {
		          userEmail = user.email; 
		        }
        document.getElementById("yourName").innerHTML = 'Welcome, ' + '' + userEmail; 		
				displayProfile();
			}, function(error){
					alert(error.message);
				})
		};

		function handleSignout() {
		  firebase.auth().signOut()
		  displaySignup()
		};

		// Forgot Password Logic

			// When the user clicks anywhere outside of the modal, close it
			var modal = document.getElementById('forgotPassword');
			window.onclick = function(event) {
			    if (event.target == modal) {
			        modal.style.display = "none";
			    }
}

		function resetPassword () {
		  var auth = firebase.auth();
		  const emailAddress = document.getElementById('forgotPasswordEmail').value;
		  auth.sendPasswordResetEmail(emailAddress).then(function() {
		    // Display the result of the reset password submission
		    document.getElementById('forgotPasswordForm').style.display = "none";
		    document.getElementById('submitPasswordReset').style.display = "none";
		    document.getElementById('forgotPasswordResult').style.display = "block";
		    document.getElementById('forgotPasswordResult').innerHTML = "Thank you. Please check your email for a link to reset your password.";

		  }, function(error) {
		      // Display Error Message
		    document.getElementById('forgotPasswordResult').innerHTML = 
		        "<div class=\"alert alert-danger\" role=\"alert\" align=\"center\"> \
		        <strong>" + error.message + "</strong>\
		      </div>";
		  });
	}



		
		</script>

	</body>

</html>